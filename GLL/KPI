SELECT COUNT(DISTINCT g.GLL_NO)
FROM GLL g
WHERE 
    EXISTS (
        -- Check LicenceAndPermitPoly misalignment
        SELECT 1 FROM LicenceAndPermitPoly lp
        WHERE lp.LicenceAndPermitNUMBER = g.GLL_NO
        AND NOT EXISTS (
            SELECT 1 FROM (
                SELECT REGEXP_SUBSTR(g.Polygon, '[^,]+', 1, LEVEL) AS PolyID
                FROM DUAL CONNECT BY REGEXP_SUBSTR(g.Polygon, '[^,]+', 1, LEVEL) IS NOT NULL
            ) extracted
            WHERE extracted.PolyID = lp.LicenceAndPermitPolyID
        )
    )
    OR
    EXISTS (
        -- Check LicenceAndPermitLine misalignment
        SELECT 1 FROM LicenceAndPermitLine ll
        WHERE ll.LicenceAndPermitNUMBER = g.GLL_NO
        AND NOT EXISTS (
            SELECT 1 FROM (
                SELECT REGEXP_SUBSTR(g.Polyline, '[^,]+', 1, LEVEL) AS LineID
                FROM DUAL CONNECT BY REGEXP_SUBSTR(g.Polyline, '[^,]+', 1, LEVEL) IS NOT NULL
            ) extracted
            WHERE extracted.LineID = ll.LicenceAndPermitLineID
        )
    );
